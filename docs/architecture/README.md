# 🏗️ Архитектура проекта

Обзор архитектуры Space4Quizlet Server.

## 🎯 Общие принципы

Space4Quizlet Server построен на принципах:

- **Модульность** - четкое разделение на модули
- **Масштабируемость** - возможность легкого расширения
- **Тестируемость** - простота написания тестов
- **Безопасность** - встроенные механизмы защиты

## 🏛️ Архитектурные слои

```
┌─────────────────────────────────────┐
│           Presentation Layer        │
│         (Controllers, DTOs)         │
├─────────────────────────────────────┤
│           Business Layer            │
│         (Services, Guards)          │
├─────────────────────────────────────┤
│         Infrastructure Layer        │
│    (Database, External APIs)        │
└─────────────────────────────────────┘
```

## 📁 Структура проекта

```
src/
├── modules/                    # Бизнес-модули
│   ├── auth/                  # Аутентификация и авторизация
│   │   ├── auth.controller.ts
│   │   ├── auth.service.ts
│   │   ├── auth.module.ts
│   │   └── dto/
│   ├── user/                  # Управление пользователями
│   │   ├── user.controller.ts
│   │   ├── user.service.ts
│   │   ├── user.module.ts
│   │   └── dto/
│   ├── card/                  # Управление карточками
│   │   ├── card.controller.ts
│   │   ├── card.service.ts
│   │   ├── card.module.ts
│   │   └── dto/
│   └── set/                   # Управление наборами
│       ├── set.controller.ts
│       ├── set.service.ts
│       ├── set.module.ts
│       └── dto/
├── infrastructure/            # Инфраструктурный слой
│   ├── database/             # База данных
│   │   ├── schema/          # Prisma схема
│   │   ├── services/        # Сервисы БД
│   │   └── database.module.ts
│   ├── config/              # Конфигурация
│   │   ├── env/            # Переменные окружения
│   │   └── config.module.ts
│   └── integrations/        # Внешние интеграции
│       └── dictionary/      # API словаря
├── shared/                   # Общие компоненты
│   ├── decorators/          # Декораторы
│   ├── guards/              # Guards
│   ├── interceptors/        # Interceptors
│   ├── filters/             # Exception filters
│   └── utils/               # Утилиты
└── main.ts                  # Точка входа
```

## 🔧 Модули

### Auth Module

- **Назначение**: Аутентификация и авторизация
- **Компоненты**: JWT стратегия, Guards, Decorators
- **Функции**: Регистрация, вход, обновление токенов

### User Module

- **Назначение**: Управление пользователями
- **Компоненты**: CRUD операции, профили, настройки
- **Функции**: Создание, обновление, удаление пользователей

### Card Module

- **Назначение**: Управление карточками для изучения
- **Компоненты**: Создание карточек, интеграция со словарем
- **Функции**: CRUD карточек, автоматическое заполнение данных

### Set Module

- **Назначение**: Управление наборами карточек
- **Компоненты**: Группировка карточек, категории
- **Функции**: Создание наборов, управление содержимым

## 🗄️ База данных

### Архитектура БД

- **ORM**: Prisma
- **СУБД**: PostgreSQL
- **Структура**: Модульная схема с отдельными файлами для моделей и перечислений

### Основные сущности

- **User** - пользователи системы
- **Card** - карточки для изучения
- **Set** - наборы карточек
- **Progress** - прогресс изучения
- **Session** - сессии пользователей

## 🔐 Безопасность

### Аутентификация

- **JWT токены** - Access и Refresh токены
- **Argon2** - хеширование паролей
- **Сессии** - управление активными сессиями

### Авторизация

- **Роли**: USER, PREMIUM, MANAGER, ADMIN
- **Guards** - проверка прав доступа
- **Decorators** - @RequireRoles, @Public

### Защита

- **Helmet** - HTTP заголовки безопасности
- **CORS** - настройка кросс-доменных запросов
- **Rate Limiting** - ограничение частоты запросов

## 🔄 Жизненный цикл запроса

```
1. Request → 2. Middleware → 3. Guard → 4. Controller → 5. Service → 6. Database
                                                                    ↓
7. Response ← 6. Service ← 5. Database ← 4. Controller ← 3. Guard ← 2. Middleware
```

## 📊 Мониторинг и логирование

### Логирование

- **Structured logging** - структурированные логи
- **Log levels** - разные уровни логирования
- **Context** - контекстная информация

### Мониторинг

- **Health checks** - проверка состояния сервисов
- **Metrics** - метрики производительности
- **Error tracking** - отслеживание ошибок

## 🚀 Масштабирование

### Горизонтальное масштабирование

- **Stateless** - приложение не хранит состояние
- **Load balancing** - балансировка нагрузки
- **Database pooling** - пулы соединений с БД

### Вертикальное масштабирование

- **Memory optimization** - оптимизация памяти
- **Database indexing** - индексы для производительности
- **Caching** - кеширование данных

## 📚 Дополнительно

- **[Модули](modules.md)** - Подробное описание модулей
- **[Паттерны](patterns.md)** - Используемые паттерны проектирования
- **[Конфигурация](configuration.md)** - Система конфигурации

## 🔗 Связанные разделы

- **[API документация](../api/README.md)** - Документация API
- **[База данных](../database/README.md)** - Работа с БД
- **[Развертывание](../deployment/README.md)** - Развертывание приложения
